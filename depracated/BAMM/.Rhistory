setwd("~/Documents/GitHub/microsat/BAMM")
library(phytools)
library(geiger)
library(ape)
library(BAMMtools)
library(coda)
library(evobiR)
# read in sampled trees
trees <- read.nexus("../data/trees/post.nex")
source('~/Documents/GitHub/microsat/BAMM/BAMM.setup.R', echo=TRUE)
# select a tree at random for making a continuous trait map
tree.BAMM1 <- trees[[3]]
# read in  microsatellite data
dat.microsat <- read.csv("../results/ssr.inference/micRocounter_results_TII.csv",
as.is=T,
row.names = 4)
# fill in the column with all microsatellite content from dat.microsat
totalmers <- dat.microsat[,9]
# adds names to the bpMbp vector from dat.microsat
names(totalmers) <- row.names(dat.microsat)
#drop the tips
tree.pruned <- drop.tip(phy=tree.BAMM1, tip= c("B.terrestris", "Plutella_xylostella"))
#write the new tree into the BAMM folder
write.tree(tree.pruned, file = "tree(3).new")
#load in tree
tree.BAMM1 <- read.tree("tree(3).new")
#tree needs to be ultrametric and binary
is.ultrametric(tree.BAMM3)
is.binary(tree.BAMM3)
#load in tree
tree.BAMM3 <- read.tree("tree(3).new")
rm("tree.BAMM1")
#tree needs to be ultrametric and binary
is.ultrametric(tree.BAMM3)
is.binary(tree.BAMM3)
#does not work because data is not in correct format
setBAMMpriors(phy = tree.BAMM3, traits = totalmers)
#plot the loglike to see if it's reached convergence
mcmcout <- read.csv("totalmers.microsat.mcmc_out.txt", header =T)
plot(mcmcout$logLik ~ mcmcout$generation)
#specify 10% burnin
burnstart <- floor(0.1*nrow(mcmcout))
postburn <- mcmcout[burnstart:nrow(mcmcout),]
#came up with effective size of 735.2577
effectiveSize(postburn$N_shifts)
#came up with effective size of 415.7432
effectiveSize(postburn$logLik)
edata <- getEventData(tree.BAMM1, eventdata = "event_data.txt", burnin = 0.1, type = "trait")
edata <- getEventData(tree.BAMM3, eventdata = "event_data.txt", burnin = 0.1, type = "trait")
post_probs <- table(postburn$N_shifts)/nrow(postburn)
names(post_probs)
shift_probs <- summary(edata)
#makes a credible shift set; calculates the expected number of shifts to be most
#likely
css <- credibleShiftSet(edata, expectedNumberOfShifts = 1, threshold = 15, set.limit = 0.95)
css$number.distinct
summary(css)
write.table(summary(css), "microsatsummary.txt")
marg_probs <- marginalShiftProbsTree(edata)
save.image("~/Documents/GitHub/microsat/BAMM/BAMM_tree3.RData")
#plot phylorate figures
phylorate <- plot.bammdata(edata, breaksmethod = "jenks")
ratesHistogram(phylorate, plotBrks = T, xlab = "Trait Rates")
title(main="jenks", cex.main=1)
